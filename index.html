<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pac-Man Game</title>
  <style>
    body {
      margin: 0;
      background: black;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    canvas {
      border: 2px solid white;
      background: black;
    }
  </style>
</head>
<body>
  <canvas id="game" width="400" height="400"></canvas>
  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    const tileSize = 20;
    const map = [
      "####################",
      "#........##........#",
      "#.####.#.##.#.####.#",
      "#o####.#.##.#.####o#",
      "#.####.#.##.#.####.#",
      "#..................#",
      "#.####.######.####.#",
      "#......#....#......#",
      "######.# ## #.######",
      "      #.#  #.#      ",
      "######.# ####.#.####",
      "#........##........#",
      "#.####.#.##.#.####.#",
      "#o...#.#....#.##..o#",
      "###.#.#.##.#.#.#.###",
      "#......#....#......#",
      "#.##############.###",
      "#..................#",
      "####################"
    ];

    const pacman = {
      x: 1,
      y: 1,
      dirX: 0,
      dirY: 0,
      nextDirX: 0,
      nextDirY: 0,
      speed: 5,
      frame: 0
    };

    function canMove(x, y) {
      return map[y] && map[y][x] && map[y][x] !== "#";
    }

    function drawMap() {
      for (let y = 0; y < map.length; y++) {
        for (let x = 0; x < map[y].length; x++) {
          if (map[y][x] === "#") {
            ctx.fillStyle = "blue";
            ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);
          } else if (map[y][x] === ".") {
            ctx.fillStyle = "white";
            ctx.beginPath();
            ctx.arc(x * tileSize + tileSize / 2, y * tileSize + tileSize / 2, 2, 0, Math.PI * 2);
            ctx.fill();
          } else if (map[y][x] === "o") {
            ctx.fillStyle = "white";
            ctx.beginPath();
            ctx.arc(x * tileSize + tileSize / 2, y * tileSize + tileSize / 2, 5, 0, Math.PI * 2);
            ctx.fill();
          }
        }
      }
    }

    function drawPacman() {
      ctx.fillStyle = "yellow";
      ctx.beginPath();
      ctx.arc(
        pacman.x * tileSize + tileSize / 2,
        pacman.y * tileSize + tileSize / 2,
        tileSize / 2 - 2,
        0.25 * Math.PI,
        1.75 * Math.PI
      );
      ctx.lineTo(pacman.x * tileSize + tileSize / 2, pacman.y * tileSize + tileSize / 2);
      ctx.fill();
    }

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawMap();
      drawPacman();

      // 다음 방향으로 이동 가능한 경우 방향 전환
      if (canMove(pacman.x + pacman.nextDirX, pacman.y + pacman.nextDirY)) {
        pacman.dirX = pacman.nextDirX;
        pacman.dirY = pacman.nextDirY;
      }

      // 현재 방향으로 이동 가능하면 이동
      if (pacman.frame % pacman.speed === 0) {
        if (canMove(pacman.x + pacman.dirX, pacman.y + pacman.dirY)) {
          pacman.x += pacman.dirX;
          pacman.y += pacman.dirY;
        }
      }

      pacman.frame++;
      requestAnimationFrame(gameLoop);
    }

    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowUp") {
        pacman.nextDirX = 0;
        pacman.nextDirY = -1;
      } else if (e.key === "ArrowDown") {
        pacman.nextDirX = 0;
        pacman.nextDirY = 1;
      } else if (e.key === "ArrowLeft") {
        pacman.nextDirX = -1;
        pacman.nextDirY = 0;
      } else if (e.key === "ArrowRight") {
        pacman.nextDirX = 1;
        pacman.nextDirY = 0;
      }
    });

    gameLoop();
  </script>
</body>
</html>
